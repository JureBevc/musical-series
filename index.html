<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Music With Numbers</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  </head>
  <body class="text-light bg-dark">
    <table class="table">
      <tbody>
        <tr>
          <td>
            <!-- Button trigger modal -->
            <button
              type="button"
              class="btn btn-dark"
              data-toggle="modal"
              data-target="#exampleModal"
            >
              How to use
            </button>
          </td>
          <td>
            <div class="dropdown">
              <button
                class="btn btn-dark dropdown-toggle"
                type="button"
                id="dropdownMenuButton"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <b>Load preset</b>
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" onclick="loadPreset(0)" href="#"
                  >Simple linear</a
                >
                <a class="dropdown-item" onclick="loadPreset(1)" href="#"
                  >Fibonacci</a
                >
                <a class="dropdown-item" onclick="loadPreset(2)" href="#">Pi</a>
                <a class="dropdown-item" onclick="loadPreset(3)" href="#"
                  >Euler</a
                >
                <a class="dropdown-item" onclick="loadPreset(4)" href="#"
                  >Magic numbers</a
                >
              </div>
            </div>
          </td>
          <td>
            <button
              id="playButton"
              onclick="PlayButtonClick();"
              type="button"
              class="btn btn-success"
            >
              Play
            </button>
          </td>
          <td>
            <div class="bpm-slider-container">
              <label for="bpmRange" class="text-light bg-dark">BPM:</label>
              <input
                type="range"
                min="60"
                max="360"
                value="50"
                id="bpmRange"
                onchange="BPMChange();"
              />
            </div>
          </td>
          <td>
            <div class="volume-slider-container">
              <label for="volumeRange" class="text-light bg-dark"
                >Master volume:</label
              >
              <input
                type="range"
                min="0"
                max="100"
                value="50"
                id="volumeRange"
                onchange="VolumeChange();"
              />
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <table class="table table-dark sequence-table">
      <thead>
        <tr>
          <th style="width: 25%" scope="col">Sequences</th>
          <th style="width: 75%" scope="col">Visuals</th>
        </tr>
      </thead>
      <tbody id="sequence-table-body"></tbody>
    </table>
    <button
      id="addButton"
      onclick="addNewSequence();"
      type="button"
      class="btn btn-success"
    >
      New +
    </button>
    <button
      id="removeAllButton"
      onclick="removeAllSequences();"
      type="button"
      class="btn btn-dark"
    >
      Clear all
    </button>
    <button
    id="copyUrlButton"
    onclick="copyUrl();"
    type="button"
    class="btn btn-dark"
  >
    Copy URL to clipboard
  </button>

    <table id="sequence-template" hidden>
      <tbody>
        <tr class="sequence-row">
          <td>
            <div class="sequence-block bg-gradient-dark">
              <button
                onclick="removeSequenceButton(this);"
                type="button"
                class="remove-sequence-button btn btn-dark"
              >
                X
              </button>
              <h3 class="sequence-name">Sequence #1</h3>
              <hr class="dotted" />
              <b>Variables:</b>
              <div class="variable-buttons">
                <!-- Add all variables -->
              </div>
              <button
                onclick="addNewVariableButton(this);"
                type="button"
                class="add-variable-button btn btn-success"
              >
                New variable +
              </button>
              <hr class="dotted" />
              <div class="key-container">
                <div class="dropdown">
                  Key:
                  <button
                    class="btn btn-dark dropdown-toggle"
                    type="button"
                    id="dropdownMenuButton"
                    data-toggle="dropdown"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    C major
                  </button>
                  <div
                    class="dropdown-menu"
                    aria-labelledby="dropdownMenuButton"
                  >
                    <!-- Add all available keys -->
                  </div>
                </div>

                <div class="octave-shift-container">
                  <div class="dropdown">
                    Octave shift:
                    <button
                      class="btn btn-dark dropdown-toggle"
                      type="button"
                      id="dropdownMenuButton"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="false"
                    >
                      0
                    </button>
                    <div
                      class="dropdown-menu"
                      aria-labelledby="dropdownMenuButton"
                    >
                      <a
                        class="dropdown-item"
                        onclick="octaveButton(this)"
                        href="#"
                        >2</a
                      >
                      <a
                        class="dropdown-item"
                        onclick="octaveButton(this)"
                        href="#"
                        >1</a
                      >
                      <a
                        class="dropdown-item"
                        onclick="octaveButton(this)"
                        href="#"
                        >0</a
                      >
                      <a
                        class="dropdown-item"
                        onclick="octaveButton(this)"
                        href="#"
                        >-1</a
                      >
                      <a
                        class="dropdown-item"
                        onclick="octaveButton(this)"
                        href="#"
                        >-2</a
                      >
                      <a
                        class="dropdown-item"
                        onclick="octaveButton(this)"
                        href="#"
                        >-3</a
                      >
                    </div>
                  </div>
                </div>

                <div class="wave-type-container">
                  <div class="dropdown">
                    Wave type:
                    <button
                      class="btn btn-dark dropdown-toggle"
                      type="button"
                      id="dropdownMenuButton"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="false"
                    >
                      sine
                    </button>
                    <div
                      class="dropdown-menu"
                      aria-labelledby="dropdownMenuButton"
                    >
                      <a
                        class="dropdown-item"
                        onclick="waveButton(this)"
                        href="#"
                        >sine</a
                      >
                      <a
                        class="dropdown-item"
                        onclick="waveButton(this)"
                        href="#"
                        >square</a
                      >
                      <a
                        class="dropdown-item"
                        onclick="waveButton(this)"
                        href="#"
                        >sawtooth</a
                      >
                      <a
                        class="dropdown-item"
                        onclick="waveButton(this)"
                        href="#"
                        >triangle</a
                      >
                    </div>
                  </div>
                </div>

                <div class="volume-container">
                  Volume:
                  <input
                    type="range"
                    min="0"
                    max="100"
                    value="100"
                    id="volumeRange"
                    onchange="sequenceVolumeChange(this);"
                  />
                </div>
              </div>
            </div>
          </td>
          <td class="canvas-cell">
            <canvas class="sequence-canvas" width="1440" height="266"></canvas>
          </td>
        </tr>
      </tbody>
    </table>

    <div id="variable-data-template" hidden>
      <div class="variable-data">
        <button
          onclick="removeVariableButton(this);"
          type="button"
          class="remove-variable-button btn btn-dark"
        >
          x
        </button>
        <button
          onclick="changeInitialValue(this)"
          type="button"
          class="btn btn-dark"
        >
          <div>
            <span class="initial-text"></span
            ><span class="initial-value"></span>
          </div>
        </button>
        <button
          onclick="changeNextValue(this)"
          type="button"
          class="btn btn-dark"
        >
          <div>
            <span class="next-text"></span><span class="next-value"></span>
          </div>
        </button>
      </div>
    </div>

    <div class="toast" data-autohide="false">
      <div class="toast-header bg-dark">
        <button type="button" class="ml-2 mb-1 close bg-danger" data-dismiss="toast">&times;</button>
        <strong class="mr-auto text-primary text-danger">Error in sequence</strong>
      </div>
      <div id="toast-text" class="toast-body bg-dark">
        Some text inside the toast body
      </div>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header bg-dark">
            <h5 class="modal-title" id="exampleModalLabel">How to use</h5>
          </div>
          <div class="modal-body bg-dark">
            <h3>Playing notes</h3>
            Every sequence has a variable called <b>note</b> that determines what note in the scale will play.<br>
            Example: note values <b>0,1,2</b> will play notes <b>C,D,E</b> if the C major scale is selected.
            <h3 style="margin-top: 5%;">Variables</h3>
            Variables change their value every time a note is played. They start with an <b>initial</b> value and their <b>next</b> value is calculated using a custom math expression.<br>
            Example: If we set the initial value for variable <b>note</b> to 0 and its next expression to <b>note + 1</b>, then we get a sequence <b>0,1,2,3,4,...</b>
            <br>
            <br>
            You can use multiple variables to help you construct your note sequence. Click <b>Load presets</b> to see some examples.

            <h3 style="margin-top: 5%;">Tips</h3>
            You can use an internal variable called <b>note_index</b> that is always set to the current note count.<br>
            Example: A variable with a next value set to <b>note_index</b> will produce values <b>0,1,2,3,...</b>
            <br>
            <br>
            You can also use lists of numbers in your expressions. Example:<br>
            A variable set to expression <b>[0,1,2,3][1]</b> will extract the first number from the list, which is 0.
            <br>
            Visit <a href="https://mathjs.org/docs/expressions/syntax.html">this page</a> for a full list of supported operators.


            <h3 style="margin-top: 5%;">Settings</h3>
            Adjust the beats per minute with the <b>BPM slider</b>.
          </div>
          <div class="modal-footer bg-dark">
            <button type="button" class="btn btn-success" data-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
      integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
      integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.3.0/math.min.js"
      integrity="sha512-pRkiEK307FcdaOBL0UjEh6i+AZTq+utCsISMzSHV6x2YvXpVKTyV7MK28mJ0YGwqZgX/KtRiaciWLkILU9iUkA=="
      crossorigin="anonymous"
    ></script>

    <script src="src/util.js"></script>
    <script src="src/sequence.js"></script>
    <script src="src/sequence-ui.js"></script>
    <script src="src/ui.js"></script>
    <script src="src/main.js"></script>
  </body>
</html>
